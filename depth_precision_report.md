# 深度格式精度分析报告：R16F vs R16Unorm

## 核心发现

1. **在小值区域（约<0.03），R16F提供更高精度**
   - R16F格式的精度分布是非线性的，在接近0的值区域提供极高的精度
   - 对于归一化到0-1的线性深度值，这一特性使R16F在近处物体深度表示上有优势

2. **精度交叉点位于0.0318**
   - 当归一化深度值小于0.0318时，R16F提供更高精度
   - 当归一化深度值大于0.0318时，R16Unorm提供更高精度

3. **线性Eye Depth值与Far Plane的关系**
   - 根据不同Far Plane（50m、100m、200m）的分析，R16F在SSAO相关范围（0-10m）内的精度优势非常明显
   - 精度交叉点随Far Plane的增加而向更远处移动（50m时为1.56m，100m时为3.12m，200m时为6.21m）

## 关键数值比较

| 深度值   | R16F精度       | R16Unorm精度    | 优势比率 | 更好格式  |
|---------|---------------|----------------|---------|---------|
| 0.0001  | 0.0000000596  | 0.0000152590   | 256.00  | R16F    |
| 0.001   | 0.0000009537  | 0.0000152590   | 16.00   | R16F    |
| 0.01    | 0.0000076294  | 0.0000152590   | 2.00    | R16F    |
| 0.1     | 0.0000610352  | 0.0000152590   | 0.25    | R16Unorm |
| 0.5     | 0.0004882812  | 0.0000152590   | 0.03    | R16Unorm |

## SSAO相关深度范围分析

对于SSAO相关的近处深度范围（0-10m）：

| Far Plane | R16F更优比例 | R16Unorm更优比例 | 精度交叉点 |
|-----------|------------|----------------|----------|
| 50m       | 94.6%      | 5.4%           | 1.56m    |
| 100m      | 97.7%      | 2.3%           | 3.12m    |
| 200m      | 99.4%      | 0.6%           | 6.21m    |

## 分析结论

1. **你的观察是正确的**：虽然R16Unorm理论上应该在全范围内提供更均匀的精度分布，但在实际SSAO应用中，R16F确实表现更好。

2. **现象解释**：
   - SSAO算法主要关注近景深度差异，这恰好是R16F格式提供高精度的区域
   - 随着Far Plane的增加，R16F的优势区域覆盖了更多的近景区域
   - 当Far Plane设置为200m时，R16F在0-6.21m范围内都提供更高精度，这覆盖了SSAO最关键的区域

3. **Far Plane影响**：
   - 你的Far Plane设置越大，R16F相对于R16Unorm的优势区域就越广
   - 这解释了为什么你观察到用R16F存储Linear Eye Depth比用R16Unorm效果更好

4. **符号位"浪费"的补偿**：
   - 虽然R16F"浪费"了1位符号位，但其非线性精度分布在小值区域提供了远超R16Unorm的精度
   - 在SSAO应用场景中，这种精度分布特性的优势远超过符号位的"浪费"

## 建议

1. 对于SSAO应用，如果保持现有的Far Plane设置，R16F是更好的选择。

2. 如果必须使用R16Unorm，可以考虑：
   - 减小Far Plane值（如果可能）
   - 应用非线性变换（如平方根）来重分配精度
   - 使用自定义编码/解码方案来提高近处精度

## 附图

详见生成的图表文件：
- depth_precision_comparison_en.png：基础精度比较
- eye_depth_analysis.png：线性Eye Depth在不同Far Plane下的分析 